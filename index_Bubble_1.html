<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"--> <!--<![endif]-->
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>BANKBOOKZ2</title>
    <meta name="description" content="BnkBkz2_APP">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="./favicon.ico" />
    <style>
        body {
            background: black;
            color: steelblue;
            font-size: 1.2em;
            padding: 1% 4.444% 1% 4.444%;
            font-family: verdana;
            height: 100%;
            min-height: 100%;
            display: flex;
            flex: 1;
            flex-direction: column;
        }

        .main_header {
            background: black;
            border: solid 1px purple;
            border-radius: 13px;
            margin: 1%;
            padding: 0.666em;
            margin-bottom: 0.444em;
            box-shadow: inset 0px 3px 10px purple;
            display: flex;
            justify-content: center;
            flex: 0;
            box-shadow: inset 0px 0px 10px 0px #0404bb;
        }

        .main_menu {
            background: rgb(72, 80, 111);
            border: solid 1px rgb(0, 128, 45);
            border-radius: 13px;
            margin: 1% auto;
            padding: 0.666em 1em;
            margin-bottom: 0.444em;
            box-shadow: inset 0px 3px 10px purple;
            display: flex;
            justify-content: space-evenly;
            max-width: 80%;
            font-size: 0.666em;
            flex: 0;
        }

        .BTN {
            background: grey;
            border-radius: 8px;
            border: solid 1px darkslateblue;
            cursor: pointer;
            color: cyan;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 0.888em;
        }

        .BTN:hover {
            border: 1px solid steelblue;
            color: purple;
        }

        .BTN:active {
            border: 1px solid lime;
            color: green;
        }

        .hiddenTab {
            display: none !important;
        }

        article {
            background: black;
            border: solid 1px lime;
            border-radius: 13px;
            margin: 1%;
            padding: 3%;
            box-shadow: inset 0px 0px 7px lime;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            height: 100%;
            min-height: 100%;
            flex: 1;
        }

        header {
            margin-bottom: 1em;
            display: flex;
            justify-content: space-between;
            color: aqua;
        }

        textarea {
            background: black;
            color: lime;
            width: 91%;
            padding: 4%;
            border-radius: 13px;
            box-shadow: 0px 0px 8px purple;
            border: 1px solid steelblue;
            flex: 1;
            /* height: 80%; */
            resize: vertical;
        }

        /* ***********************************CUSTOM SCROLLBAR****************************/
        .scrollBarV {
            overflow-x: scroll;
        }

        .scrollBarV::-webkit-scrollbar-track {
            background-color: #010213;
            border-radius: 13px;
        }

        .scrollBarV::-webkit-scrollbar {
            width: 0.666em;
            height: 100%;
        }

        .scrollBarV::-webkit-scrollbar-thumb {
            background-color: #04223c;
            border-radius: 13px;
            background-image: -webkit-linear-gradient(0deg, rgba(255, 255, 255, 0.6) 26%, transparent 26%, transparent 51%, rgba(255, 255, 255, -0.4) 51%, rgba(255, 255, 255, 0.6) 74%, transparent 74%, transparent);
        }

        .scrollBarH {
            overflow-y: scroll;
        }

        .scrollBarH::-webkit-scrollbar-track {
            background-color: #010213;
            border-radius: 13px;
        }

        .scrollBarH::-webkit-scrollbar {
            height: 0.666em;
            width: 100%;
        }

        .scrollBarH::-webkit-scrollbar-thumb {
            background-color: #04223c;
            border-radius: 13px;
            /* background-image: -webkit-linear-gradient(0deg, rgba(255, 255, 255, 0.6) 26%, transparent 26%, transparent 51%, rgba(255, 255, 255, -0.4) 51%, rgba(255, 255, 255, 0.6) 74%, transparent 74%, transparent); */
        }

        .txtSizer::-webkit-scrollbar {
            width: 1.222em;
            background: black;
        }

        .viewFrame1 {
            max-width: 44em;
            min-height: 33em;
        }

        @media only screen and (max-width: 800px) {
            body {
                background-color: #00070d;
                padding: 2%;
            }

            .BTN {
                font-size: 0.999em;
            }

        }
    </style>
    <!-------------------------------- CHART.JS -------------------------------->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .chart-container {
            /* position: relative;
            height: 80vh;
            width: 80vw; */
            background: #2a2a2a;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            border: 1px solid #444;
        }
    </style>

<body>
    <header class="main_header">ai_BANKBOOKZ_2</header>
    <aside class="main_menu">
        <button class="BTN" onclick="go_INFO()">INFO</button>
        <button class="BTN" style="margin:0 1em 0 1em;" onclick="go_CHARTS()">CHARTS</button>
        <button class="BTN" onclick="go_DATA()">DATA</button>
        <button class="BTN" style="margin:0 1em 0 1em;" onclick="go_TEST()">TEST</button>
    </aside>

    <article id="INFO_VIEW" class="hiddenTab viewFrame1">
        <header>INFO_VIEW:</header>
        <h3>PURPOSE:</h3>
        <p>This is an AI study project to implement the following:</p>
        <ul>
            <li>2D financial bubble chart</li>
            <li>Financial Data storage</li>
            <li>3D financial bubble chart</li>
            <li>AI to vibe code this site</li>
            <li>AI ADK financial data review.</li>
        </ul>
        <!-- <textarea placeholder="INFO View Content"></textarea> -->
    </article>

    <article id="CHARTS_VIEW" class="hiddenTab viewFrame1">
        <header>CHARTS_VIEW:</header>
        <section style="margin-bottom: 1em; display: flex; gap: 10px; flex-wrap: wrap;">
            <div>
                <label for="select_X" style="font-size: 0.6em; color: steelblue;">X Axis</label>
                <select id="select_X" class="BTN" style="padding: 5px;">
                    <option value="%Growth" selected>%Growth</option>
                    <option value="PRICE">PRICE</option>
                    <option value="VOLUME">VOLUME</option>
                    <option value="MARKETCAP">MARKETCAP</option>
                </select>
            </div>
            <div>
                <label for="select_Y" style="font-size: 0.6em; color: steelblue;">Y Axis</label>
                <select id="select_Y" class="BTN" style="padding: 5px;">
                    <option value="%Growth">%Growth</option>
                    <option value="PRICE">PRICE</option>
                    <option value="VOLUME" selected>VOLUME</option>
                    <option value="MARKETCAP">MARKETCAP</option>
                </select>
            </div>
            <div>
                <label for="select_Z" style="font-size: 0.6em; color: steelblue;">Radius (Z)</label>
                <select id="select_Z" class="BTN" style="padding: 5px;">
                    <option value="%Growth">%Growth</option>
                    <option value="PRICE">PRICE</option>
                    <option value="VOLUME">VOLUME</option>
                    <option value="MARKETCAP" selected>MARKETCAP</option>
                </select>
            </div>
            <button class="BTN" onclick="render_MARKET_DATA()" style="max-width:10em; 
                vertical-align: bottom; margin-left: 152px;">RENDER</button>
        </section>
        <div class="chart-container">
            <canvas id="bubbleChart"></canvas>
        </div>
    </article>

    <article id="DATA_VIEW" class="hiddenTab viewFrame1">
        <header>DATA_VIEW:</header>
        <section style="margin-bottom: 1em;">
            <input id="api_key_input" type="password" placeholder="Enter FMP Key (optional)"
                style="width: 200px; padding: 5px; margin-right: 10px;" oninput="save_KEY()">
            <button class="BTN" onclick="load_MARKET_DATA()" style="max-width:10em; vertical-align: bottom;">Load Market
                Data</button>
            <button class="BTN"
                onclick="const keyInput = document.getElementById('api_key_input'); keyInput.type = keyInput.type === 'password' ? 'text' : 'password';"
                style="vertical-align: bottom; margin-left: 5px;">üëÅÔ∏è</button>

        </section>
        <textarea id="DATA_TEXTAREA_1" placeholder="Data View Content" class="scrollBarV txtSizer"
            style="font-family: monospace; font-size: 0.8em;min-height: 44em;"></textarea>
    </article>

    <article id="TEST_VIEW" class="hiddenTab viewFrame1">
        <header>TEST_VIEW:</header>
        <section style="margin-bottom: 1em;">
            <button class="BTN" onclick="load_TEST_DATA()" style="max-width:10em; vertical-align: bottom;">
                Load Test Data</button>

        </section>
        <textarea id="DATA_TEST_AREA_4" placeholder="Test View Content"></textarea>
    </article>

    <footer style="margin-top: 2%; font-size: 0.444em; color: darkslategray; text-align: center;">
        2020 - <span id="dateTXTStamp"></span> ¬© NetCinematics llc. All rights reserved.
    </footer>

    <script>
        // DATES
        document.getElementById('dateTXTStamp').innerHTML = new Date().getFullYear();

        // VIEWS
        const views = ['INFO_VIEW', 'CHARTS_VIEW', 'DATA_VIEW', 'TEST_VIEW'];

        const hideAllViews = () => {
            views.forEach(viewId => {
                document.getElementById(viewId).classList.add('hiddenTab');
            });
        };

        const go_INFO = () => {
            hideAllViews();
            document.getElementById('INFO_VIEW').classList.remove('hiddenTab');
            console.log('Showing INFO VIEW');
        };

        const go_CHARTS = () => {
            hideAllViews();
            document.getElementById('CHARTS_VIEW').classList.remove('hiddenTab');
            console.log('Showing CHARTS VIEW');
        };

        const go_DATA = () => {
            hideAllViews();
            document.getElementById('DATA_VIEW').classList.remove('hiddenTab');
            console.log('Showing DATA VIEW');

        };

        const go_TEST = () => {
            hideAllViews();
            document.getElementById('TEST_VIEW').classList.remove('hiddenTab');
            console.log('Showing TEST VIEW');
        };

        // Initialize: Show INFO by default or empty? 
        // Showing INFO by default based on previous behavior
        go_INFO();
        init_KEY();

        function init_KEY() {
            const storedKey = localStorage.getItem('FMP_KEY');
            if (storedKey) {
                document.getElementById('api_key_input').value = storedKey;
            }
        }

        function save_KEY() {
            const key = document.getElementById('api_key_input').value;
            localStorage.setItem('FMP_KEY', key);
        }

        let MARKET_DATA_MASTER = [];
        let marketChartInstance = null;
        // let PORTFOLIO_SET = ["NVDA", "AMZN", "GOOG", "COST", "MU", "XLK", "SPY", "GDX"];
        let PORTFOLIO_SET = ["NVDA"];

        async function render_MARKET_DATA() {
            const xVal = document.getElementById('select_X').value;
            const yVal = document.getElementById('select_Y').value;
            const zVal = document.getElementById('select_Z').value;

            // Helper to map selection to object property
            const getProp = (item, selection) => {
                switch (selection) {
                    case '%Growth': return item.changesPercentage;
                    case 'PRICE': return item.price;
                    case 'VOLUME': return item.volume;
                    case 'MARKETCAP': return item.mktCap;
                    default: return 0;
                }
            };

            const chartData = MARKET_DATA_MASTER.map(item => ({
                x: getProp(item, xVal),
                y: getProp(item, yVal),
                r: Math.sqrt(getProp(item, zVal)) / 1000, // Scale radius arbitrarily for now
                item: item // keep ref
            }));

            const ctx = document.getElementById('marketChart').getContext('2d');

            if (marketChartInstance) {
                marketChartInstance.destroy();
            }

            marketChartInstance = new Chart(ctx, {
                type: 'bubble',
                data: {
                    datasets: [{
                        label: 'Market Portfolio',
                        data: chartData,
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                    }]
                },
                options: {
                    scales: {
                        x: {
                            title: { display: true, text: xVal },
                            type: 'linear', position: 'bottom'
                        },
                        y: {
                            title: { display: true, text: yVal }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const raw = context.raw;
                                    return `${raw.item.symbol}: (${xVal}:${raw.x}, ${yVal}:${raw.y})`;
                                }
                            }
                        }
                    }
                }
            });

            // Switch to chart view to see results
            go_CHARTS();
        }


        async function load_MARKET_DATA() {

            const textArea = document.getElementById('DATA_TEXTAREA_1');
            const key = document.getElementById('api_key_input').value;

            if (!key) {
                textArea.value = 'Please enter an API Key first.';
                return;
            }

            textArea.value = 'Fetching market data...';
            try {
                const response = await fetch(`https://financialmodelingprep.com/stable/search-symbol?query=AAPL&apikey=${key}`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                // Save valid key
                localStorage.setItem('FMP_KEY', key);

                const data = await response.json();
                data.splice(0, data.length, ...data.filter(item => item.currency === "USD"));

                textArea.value = JSON.stringify(data, null, 4);
            } catch (error) {
                textArea.value = 'Error fetching data: ' + error.message;
                console.error('Fetch error:', error);
            }
        }


        // TEST DATA
        async function load_TEST_DATA() {

            const textArea = document.getElementById('DATA_TEST_AREA_4');
            const key = document.getElementById('api_key_input').value;

            if (!key) {
                textArea.value = 'Please enter an API Key first.';
                return;
            }

            textArea.value = 'Fetching market data...';
            try {
                const response = await fetch(`https://financialmodelingprep.com/stable/search-symbol?query=AAPL&apikey=${key}`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                // Save valid key
                localStorage.setItem('FMP_KEY', key);

                const data = await response.json();
                data.splice(0, data.length, ...data.filter(item => item.currency === "USD"));

                textArea.value = JSON.stringify(data, null, 4);
            } catch (error) {
                textArea.value = 'Error fetching data: ' + error.message;
                console.error('Fetch error:', error);
            }
        }

    </script>

    <script>
        const ctx = document.getElementById('bubbleChart').getContext('2d');

        const data = {
            datasets: [{
                label: 'Portfolio A',
                data: [
                    { x: 20, y: 30, r: 15 },
                    { x: 40, y: 10, r: 10 },
                    { x: 10, y: 40, r: 12 },
                    { x: 50, y: 50, r: 8 },
                    { x: 30, y: 20, r: 25 },
                    { x: 35, y: 35, r: 20 },
                    { x: 25, y: 15, r: 18 }
                ],
                backgroundColor: 'rgba(255, 99, 132, 0.6)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1
            }, {
                label: 'Portfolio B',
                data: [
                    { x: 15, y: 25, r: 10 },
                    { x: 45, y: 15, r: 20 },
                    { x: 25, y: 45, r: 15 },
                    { x: 55, y: 25, r: 25 },
                    { x: 30, y: 10, r: 12 },
                    { x: 10, y: 30, r: 15 },
                    { x: 40, y: 40, r: 18 }
                ],
                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        };

        const config = {
            type: 'bubble',
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: { color: '#e0e0e0', font: { size: 14 } }
                    },
                    title: {
                        display: true,
                        text: 'Market Data Simulation (Bubble Chart)',
                        color: '#ffffff',
                        font: { size: 20, weight: 'bold' },
                        padding: { bottom: 20 }
                    }
                },
                scales: {
                    x: {
                        title: { display: true, text: 'Price ($)', color: '#aaa' },
                        grid: { color: '#444' },
                        ticks: { color: '#ccc' }
                    },
                    y: {
                        title: { display: true, text: 'Volume (M)', color: '#aaa' },
                        grid: { color: '#444' },
                        ticks: { color: '#ccc' }
                    }
                }
            }
        };

        new Chart(ctx, config);
    </script>
</body>

</html>